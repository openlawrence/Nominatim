Nominatim
=========

Nominatim (from the Latin, 'by name') is a tool to search OpenStreetMap data
by name and address (geocoding) and to generate synthetic addresses of
OSM points (reverse geocoding). An instance with up-to-date data can be found
at http://nominatim.openstreetmap.org. Nominatim is also used as one of the
sources for the Search box on the OpenStreetMap home page and powers the search
on the MapQuest Open Initiative websites.

Documentation
=============

More information about Nominatim, including usage and installation instructions,
can be found in the OSM wiki at:

http://wiki.openstreetmap.org/wiki/Nominatim

Triggers
========

CREATE TRIGGER place_before_delete BEFORE DELETE ON place FOR EACH ROW EXECUTE PROCEDURE place_delete();
CREATE TRIGGER place_before_insert BEFORE INSERT ON place FOR EACH ROW EXECUTE PROCEDURE place_insert();
CREATE TRIGGER placex_before_delete AFTER DELETE ON placex FOR EACH ROW EXECUTE PROCEDURE placex_delete();
CREATE TRIGGER placex_before_insert BEFORE INSERT ON placex FOR EACH ROW EXECUTE PROCEDURE placex_insert();
CREATE TRIGGER placex_before_update BEFORE UPDATE ON placex FOR EACH ROW EXECUTE PROCEDURE placex_update();

These are ignored.
select * from placex where class in ('landuse','natural');
select * from placex where ST_IsEmpty(geometry) OR NOT ST_IsValid(geometry) OR ST_X(ST_Centroid(geometry))::text in ('NaN','Infinity','-Infinity') OR ST_Y(ST_Centroid(geometry))::text in ('NaN','Infinity','-Infinity');
select * from placex where osm_type='R';
select osm_type,count(*) from placex group by osm_type;

# search name add words :
search_name_add_words called by update_location_nameonly called by place_insert

Installation
============

The following instructions is a quick guide to installation. A more detailed guide
how to set up your own instance of Nominatim can be found in the wiki:

http://wiki.openstreetmap.org/wiki/Nominatim/Installation

Installation steps:

0. If checking out from git run:

     ./autogen.sh

1. Compile Nominatim:

     ./configure [--enable-64bit-ids]
     make

2. Get OSM data and import:

     ./utils/setup.php --osm-file <your planet file> --all

3. Point your webserver to the ./website directory.

## Installation on Debian ##

` apt-get install build-essential libxml2-dev libgeos-dev libpq-dev libbz2-dev libtool automake libproj-dev
  apt-get install gcc proj-bin libgeos-c1 git osmosis
  apt-get install php5 php-pear php5-pgsql php5-json php-db
  apt-get install postgresql postgis postgresql-contrib postgresql-9.1-postgis postgresql-server-dev-9.1

Testing
=======

osm2pgsql -lsc -O gazetteer --hstore -C 3585 -P 5432 -d nominatim /mnt/data/home/mdupont/experiments/lawrence/Nominatim/data/255_michigan.osm


nominatim/nominatim --verbose -i -d nominatim -P 5432 -t 7 -r 30


php ./website/search_cli.php -q "900 mass"
select make_standard_name('900 Massachusets Street') as string
select word_id,word_token, word, class, type, country_code, operator, search_name_count from word where word_token in (' 900 massachusets st','900 massachusets st',' 900','900',' massachusets st','massachusets st',' massachusets','massachusets',' st','st',' 900 massachusets','900 massachusets')


* Testing running of importing one file

   osm2pgsql/osm2pgsql -lsc -O gazetteer --hstore -C 3497 -P 5432 -d nominatim data/255_michigan.osm

SQL Queries
===========
select * from word;
select * from place_addressline;
select geometry_sector,count(*) from placex where  indexed_status = 0 group by geometry_sector order by geometry_sector;
select * from placex where type != 'postcode';
select * from place_addressline a join placex b  on a.place_id = b.place_id where type != 'postcode';
select word_id,word_token, word, class, type, country_code, operator, search_name_count from word where word_token in (' 255 michigan st','255 michigan st',' 255','255',' michigan st','michigan st',' michigan','michigan',' st','st',' 255 michigan','255 michigan');
select place_id, 0::int as exactmatch from search_name where name_vector @> ARRAY[7] and address_rank between 16 and 27 order by - abs(26 - address_rank) + 3 DESC;
select * from search_name;

License
=======

The source code is available under a GPLv2 license.

Contact and Bugreports
======================

For questions you can join the geocoding mailinglist, see
http://lists.openstreetmap.org/listinfo/geocoding

Bugs may be reported on the github project site:
https://github.com/twain47/Nominatim
